<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Guest molecule visualization</title>
        <script
            src="https://code.jquery.com/jquery-3.6.3.min.js"
            integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
            crossorigin="anonymous"
        ></script>
        <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    </head>

    <body>
        <div id="viewercontainer" class="body row">
            <div
                id="viewer"
                style="width: 600px; height: 400px; position: relative"
            ></div>
        </div>

        <div style="margin-top: 20px">
            <button id="electrondensityBtn">Electron Density</button>
            <button id="homoBtn">HOMO</button>
            <button id="lumoBtn">LUMO</button>
        </div>

        <script>
            $(document).ready(function () {
                const viewer = $3Dmol.createViewer("viewer", {
                    backgroundColor: "white",
                });

                let currentSurface = null;

                function loadSystem() {
                    viewer.clear();
                    $.get(
                        "https://raw.githubusercontent.com/alexkineth/testxyz/refs/heads/main/guest/system.xyz",
                        function (data) {
                            viewer.addModel(data, "xyz");
                            viewer.setStyle(
                                {},
                                { stick: { radius: 0.2, color: "spectrum" } },
                            );
                            viewer.zoomTo();
                            viewer.render();
                        },
                        "text",
                    );
                }

                function loadSurface(cubeFile) {
                    $.get(
                        `https://raw.githubusercontent.com/alexkineth/testxyz/refs/heads/main/guest/${cubeFile}`,
                        function (cubeData) {
                            const voldata = new $3Dmol.VolumeData(
                                cubeData,
                                "cube",
                            );

                            if (viewer.hasVolumetricRender()) {
                                viewer.addVolumetricRender(voldata, {
                                    transferfn: [
                                        {
                                            color: "blue",
                                            opacity: 0.075,
                                            value: 0.1,
                                        },
                                        {
                                            color: "blue",
                                            opacity: 0.001,
                                            value: 0.01,
                                        },
                                        {
                                            color: "white",
                                            opacity: 0,
                                            value: 0,
                                        },
                                        {
                                            color: "red",
                                            opacity: 0.001,
                                            value: -0.01,
                                        },
                                        {
                                            color: "red",
                                            opacity: 0.075,
                                            value: -0.1,
                                        },
                                    ],
                                });
                            } else {
                                viewer.addIsosurface(voldata, {
                                    isoval: 0.01,
                                    color: "blue",
                                    alpha: 0.7,
                                    smoothness: 10,
                                });
                                viewer.addIsosurface(voldata, {
                                    isoval: -0.01,
                                    color: "red",
                                    alpha: 0.7,
                                    smoothness: 10,
                                });
                            }

                            viewer.render();
                        },
                        "text",
                    );
                }

                window.toggleSurface = function (cubeFile) {
                    if (currentSurface === cubeFile) {
                        currentSurface = null;
                        loadSystem();
                    } else {
                        currentSurface = cubeFile;
                        loadSystem();
                        loadSurface(cubeFile);
                    }
                };

                $("#electrondensityBtn").click(function () {
                    toggleSurface("electron-density.cube");
                });
                $("#homoBtn").click(function () {
                    toggleSurface("homo.cube");
                });
                $("#lumoBtn").click(function () {
                    toggleSurface("lumo.cube");
                });

                loadSystem();
            });
        </script>
    </body>
</html>
